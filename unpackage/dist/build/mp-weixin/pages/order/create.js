(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/create"],{2269:function(o,t,n){"use strict";n.r(t);var s=n("64a9"),e=n("f88a");for(var i in e)["default"].indexOf(i)<0&&function(o){n.d(t,o,(function(){return e[o]}))}(i);n("6512");var d=n("f0c5"),a=Object(d["a"])(e["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],void 0);t["default"]=a.exports},"2d66":function(o,t,n){},"64a9":function(o,t,n){"use strict";n.d(t,"b",(function(){return e})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return s}));var s={useListTitle:function(){return n.e("components/use-list-title/use-list-title").then(n.bind(null,"0568"))},useNumberBox:function(){return n.e("components/use-number-box/use-number-box").then(n.bind(null,"69e7"))},usePopup:function(){return n.e("components/use-popup/use-popup").then(n.bind(null,"55cc"))}},e=function(){var o=this,t=o.$createElement,n=(o._self._c,o.cart_ids&&o.cart_ids.length>0),s=o.cart_ids&&o.cart_ids.length>0,e=o.__map(o.couponDatas,(function(t,n){var s=o.__get_orig(t),e=t.end_time.split(" ");return{$orig:s,g2:e}})),i=!o.couponDatas||o.couponDatas.length<=0;o._isMounted||(o.e0=function(t){o.couponShow=!0}),o.$mp.data=Object.assign({},{$root:{g0:n,g1:s,l0:e,g3:i}})},i=[]},6512:function(o,t,n){"use strict";var s=n("2d66"),e=n.n(s);e.a},7585:function(o,t,n){"use strict";(function(o,t){var s=n("4ea4");n("cd95"),n("a9ff");s(n("66fd"));var e=s(n("2269"));o.__webpack_require_UNI_MP_PLUGIN__=n,t(e.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},"8d3f":function(o,t,n){"use strict";(function(o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={data:function(){return{addrData:{},goodsDatas:[],goods_money:0,couponShow:!1,couponName:"选择优惠券",couponDatas:[],coupon_type:"满减",coupon_money:0,total_money:0,total_coupon_money:0,cart_ids:[],goods_id:0,goods_num:1,goods_sku_id:0,order_coupon_id:0,order_desc:"",is_submit:1,platform:"",platform_name:""}},onLoad:function(t){var n=this;this.$api.get_env((function(o){n.platform=o.platform,n.platform_name=o.platform_name})),this.goods_id=t.goods_id||"",this.goods_sku_id=t.sku_id||"",t.cart_ids&&(this.cart_ids=t.cart_ids.split(",")),this.loadData(),o.$on("__event_choice_address",(function(o){n.addrData=o}))},onShow:function(){var o=this;this.addrData&&this.addrData._id||this.$db["usemall-member-address"].where("create_uid == $env.uid").tofirst().then((function(t){console.log("res",t),t&&200===t.code&&(o.addrData=t.datas)}))},methods:{loadData:function(){var o=this;this.$func.usemall.call("goods/detail2order",{cart_ids:this.cart_ids,goods_id:this.goods_id,goods_sku_id:this.goods_sku_id}).then((function(t){if(200===t.code)return o.goodsDatas=t.datas,o.calcTotalMoney(),void(o.is_submit=0);o.$api.msg(t.msg)}))},calcTotalMoney:function(){var o=this;this.goods_money=0,this.goodsDatas.forEach((function(t){t.goods_sku&&t.goods_sku.price&&(t.goods.price=t.goods_sku.price,t.goods.stock_num=t.goods_sku.stock_num),t.cart&&t.cart.goods_num&&(t.goods.goods_num=t.cart.goods_num),o.goods_money+=t.goods.price/100*t.goods.goods_num})),"满减"==this.coupon_type?(this.total_coupon_money=this.coupon_money,this.total_money=(this.goods_money+0-this.coupon_money).toFixed(2)):"折扣"==this.coupon_type&&(this.total_coupon_money=this.goods_money+0-((this.goods_money+0)*this.coupon_money).toFixed(2),this.total_money=((this.goods_money+0)*this.coupon_money).toFixed(2))},numberChange:function(o){var t=this.goodsDatas[o.index];t.goods.goods_num=o.number,this.goods_id&&(this.goods_num=o.number),this.calcTotalMoney()},couponOpen:function(){},couponUse:function(o){this.order_coupon_id=o._id,this.coupon_money=o.price,this.coupon_type=o.type,this.couponName=o.name,this.calcTotalMoney(),this.couponShow=!1},submit:function(){if(this.addrData&&this.addrData._id)if(this.is_submit)this.$api.msg("提交中");else{this.is_submit=1;var o=this,t={cart_ids:o.cart_ids,goods_id:o.goods_id,goods_num:o.goods_num,goods_sku_id:o.goods_sku_id,order_coupon_id:o.order_coupon_id,order_integral:0,order_use_integral:0,addr_id:o.addrData._id,order_from:o.platform_name,order_desc:o.order_desc};this.$func.usemall.call("order/create",t).then((function(t){200!==t.code?(o.$api.msg(t.msg),o.$api.timerout((function(){o.is_submit=0}),800)):o.$api.topay({order_id:t.datas.order_id,money:t.datas.money,type:"redirect"})}))}else this.$api.msg("请选择收货人")},toaddr:function(){o.navigateTo({url:"/pages/user/address/address?source=1",complete:function(){}})}}};t.default=n}).call(this,n("543d")["default"])},f88a:function(o,t,n){"use strict";n.r(t);var s=n("8d3f"),e=n.n(s);for(var i in s)["default"].indexOf(i)<0&&function(o){n.d(t,o,(function(){return s[o]}))}(i);t["default"]=e.a}},[["7585","common/runtime","common/vendor"]]]);