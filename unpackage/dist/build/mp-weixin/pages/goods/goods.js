(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/goods/goods"],{"2e9b":function(t,e,o){"use strict";(function(t,e){var s=o("4ea4");o("cd95"),o("a9ff");s(o("66fd"));var n=s(o("c054"));t.__webpack_require_UNI_MP_PLUGIN__=o,e(n.default)}).call(this,o("bc2e")["default"],o("543d")["createPage"])},"6c48":function(t,e,o){"use strict";(function(t){var s=o("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(o("2eee")),i=s(o("c973")),a=s(o("9523")),r=s(o("01f5")),c=o("26cb");function u(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,s)}return o}var d={components:{lPainter:function(){Promise.all([o.e("common/vendor"),o.e("uni_modules/lime-painter/components/lime-painter/index")]).then(function(){return resolve(o("1aba"))}.bind(null,o)).catch(o.oe)}},computed:function(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?u(Object(o),!0).forEach((function(e){(0,a.default)(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):u(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}({},(0,c.mapState)(["islogin","member"])),data:function(){return{id:0,mid:0,goods:{},swiperDatas:[],sku:{},skuDatas:[],shareShow:!1,posterQRcode:"",posterUrl:"",posterShow:!1,posterData:{},couponShow:!1,couponDatas:[],tagShow:!1,tagDatas:[],evaluateDatas:[],evaluateTitle:"评价",html_nodes:"",favorite:!1,scrollTop:0}},watch:{sku:function(t){this.goods.price=t.price,this.goods.market_price=t.market_price,this.goods.stock_num=t.num}},onShareAppMessage:function(t){var e=0;return this.member&&this.member._id&&(e=this.member._id),{title:this.goods.share_title,path:"/pages/goods/goods?id=".concat(this.id,"&mid=").concat(e),success:function(t){console.log("转发成功",t)},fail:function(t){console.log("转发失败",t)}}},onPageScroll:function(t){this.$refs.usetop.change(t.scrollTop)},onLoad:function(e){if(console.log("onload opts",e),e)if(this.mid=e.mid||"",e.id)this.id=e.id;else if(e.q){var o=decodeURIComponent(e.q)||decodeURIComponent(t.getStorageInfoSync("__scene_query_q"));this.resolveQueryq(o)}this.id||this.$api.msg("商品ID无效")},onShow:function(e){if(!this.id){var o=decodeURIComponent(t.getStorageInfoSync("__scene_query_q"));this.resolveQueryq(o)}this.loadData()},methods:{loadData:function(){var t=this;return(0,i.default)(n.default.mark((function e(){return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$func.usemall.call("goods/detail",{goods_id:t.id,share_mid:t.mid}).then((function(e){if(200===e.code){t.evaluateDatas=e.datas.evaluate,e.datas.evaluate_cnt&&(t.evaluateTitle="评价(".concat(e.datas.evaluate_cnt,")")),"string"===typeof e.datas.goods.imgs?t.swiperDatas=e.datas.goods.imgs.split(",").filter((function(t){return t})):t.swiperDatas=e.datas.goods.imgs,t.goods=e.datas.goods;var o=e.datas.goods_detail;t.html_nodes=o.desc_mobile;var s=e.datas.goods_skus;if(s.length>0){var n=[];s.forEach((function(e,o){n.push({id:e._id,sku:e.goods_sku,name:e.spec,price:e.price,market_price:e.market_price||t.goods.market_price,num:e.stock_num,selected:0==o})})),t.skuDatas=n}t.skuDatas.length>0&&(t.sku=t.skuDatas[0]),"string"===typeof t.goods.tags&&(t.goods.tags=t.goods.tags.split(",").filter((function(t){return t})));var i=[];return t.goods.tags.forEach((function(t,e){i.push({name:t,selected:0==e})})),t.tagDatas=i,void(t.favorite=1===t.goods.collected)}t.$api.msg(e.msg)}));case 2:case"end":return e.stop()}}),e)})))()},resolveQueryq:function(t){var e=t.split("/").slice(-1)[0].split("_");2==e.length&&(this.mid=e[1]),this.id=e[0]},preview:function(e,o){e&&t.previewImage({urls:e,current:o,longPressActions:{itemList:["发送给朋友","保存图片","收藏"],success:function(t){console.log(res)},fail:function(t){console.log(t)}}})},shareOpen:function(){this.loginCheck()&&(this.shareShow=!0)},createPoster:function(){this.posterUrl?this.posterShow=!0:(t.showLoading({title:"生成海报中"}),this.posterQRcode="https://usemall.use-cloud.com/wxmp-product/".concat(this.goods._id,"_").concat(this.member._id))},posterQRcodeResult:function(t){this.posterData=r.default.getGoodsData(this.member,this.goods,t),this.posterShow=!0},posterSuccess:function(e){this.posterUrl=e,t.hideLoading()},posterSave:function(){this.posterUrl&&(t.showLoading({title:"保存中"}),t.saveImageToPhotosAlbum({filePath:this.posterUrl,success:function(){t.hideLoading(),t.showToast({title:"海报保存成功",icon:"success",duration:2e3})}}))},selectSKU:function(t){var e=this;this.skuDatas.forEach((function(o){t.sku==o.sku?e.$set(o,"selected",!0):e.$set(o,"selected",!1)})),this.sku=t},toevaluate:function(){t.navigateTo({url:"/pages/goods/goods-evaluate?id=".concat(this.id)})},tohome:function(){this.$api.tohome()},tofavorite:function(){var t=this;if(this.loginCheck()){this.favorite=!this.favorite;var e={goods_id:this.id,state:this.favorite?"已收藏":"已取消"};this.$func.usemall.call("member/collect",e).then((function(e){e.datas?t.favorite?t.$api.msg("收藏成功"):t.$api.msg("取消成功"):t.$api.msg(e.msg)}))}},tocart:function(t){var e=this;this.loginCheck()&&this.$func.usemall.call("goods/addcart",{goods_id:t._id,goods_num:1,goods_sku:this.sku.id}).then((function(t){200!==t.code?e.$api.msg(t.msg):e.$api.msg(t.datas.msg)}))},tobuy:function(e){this.loginCheck()&&t.navigateTo({url:"/pages/order/create?goods_id=".concat(this.id,"&sku_id=").concat(this.sku.id||"")})},loginCheck:function(){if(!this.islogin){var e=this;return t.showModal({title:"授权登录",success:function(t){t.confirm&&e.$api.tologin()}}),!1}return!0}}};e.default=d}).call(this,o("543d")["default"])},"6cd4":function(t,e,o){"use strict";o.d(e,"b",(function(){return n})),o.d(e,"c",(function(){return i})),o.d(e,"a",(function(){return s}));var s={usePopup:function(){return o.e("components/use-popup/use-popup").then(o.bind(null,"55cc"))},useQrcode:function(){return Promise.all([o.e("common/vendor"),o.e("components/use-qrcode/use-qrcode")]).then(o.bind(null,"11f0"))},useListTitle:function(){return o.e("components/use-list-title/use-list-title").then(o.bind(null,"0568"))},useRate:function(){return o.e("components/use-rate/use-rate").then(o.bind(null,"c010"))},useTotop:function(){return o.e("components/use-totop/use-totop").then(o.bind(null,"61fe"))}},n=function(){var t=this,e=t.$createElement,o=(t._self._c,t.skuDatas.length),s=t.skuDatas.length,n=t.__map(t.couponDatas,(function(e,o){var s=t.__get_orig(e),n=e.end_time.split(" ");return{$orig:s,g2:n}})),i=t.evaluateDatas.length,a=i>0?t.__map(t.evaluateDatas,(function(e,o){var s=t.__get_orig(e),n=t.$api.format(e.create_time,"yyyy-MM-dd");return{$orig:s,g4:n}})):null;t._isMounted||(t.e0=function(e){t.couponShow=!0},t.e1=function(e){t.tagShow=!0}),t.$mp.data=Object.assign({},{$root:{g0:o,g1:s,l0:n,g3:i,l1:a}})},i=[]},"7dea":function(t,e,o){},c054:function(t,e,o){"use strict";o.r(e);var s=o("6cd4"),n=o("cc68");for(var i in n)["default"].indexOf(i)<0&&function(t){o.d(e,t,(function(){return n[t]}))}(i);o("d2df");var a=o("f0c5"),r=Object(a["a"])(n["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],void 0);e["default"]=r.exports},cc68:function(t,e,o){"use strict";o.r(e);var s=o("6c48"),n=o.n(s);for(var i in s)["default"].indexOf(i)<0&&function(t){o.d(e,t,(function(){return s[t]}))}(i);e["default"]=n.a},d2df:function(t,e,o){"use strict";var s=o("7dea"),n=o.n(s);n.a}},[["2e9b","common/runtime","common/vendor"]]]);