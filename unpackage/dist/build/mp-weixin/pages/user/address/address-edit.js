(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/address/address-edit"],{"0f68":function(a,e,t){"use strict";(function(a){var r=t("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var d=r(t("2eee")),n=r(t("c973")),i="usemall-member-address",s={components:{},data:function(){return{addrDefault:!1,addressName:"请选择地址 | 地图选择",addrData:{consignee:"",mobile:"",address:"",province_name:"",city_name:"",area_name:"",addr_detail:"",is_default:0,addr_source:"录入",remark:"家",longitude:"",latitude:""},id:0,type:"add"}},onLoad:function(e){var t=this,r="新增收货人";"edit"===e.type&&(r="编辑收货人",this.id=e.id,this.$db[i].tofirst(this.id).then((function(a){if(200==a.code){for(var e in t.addrData)t.addrData[e]=a.datas[e];t.addrDefault="是"==t.addrData.is_default,t.addressName=t.addrData.province_name+"-"+t.addrData.city_name+"-"+t.addrData.area_name}}))),this.type=e.type||"add",a.setNavigationBarTitle({title:r})},methods:{switchChange:function(a){this.addrDefault=a.detail.value},openAddress:function(){this.$refs.useAddress.open()},changeAddr:function(a){this.addrData.province_name=a.labelArr[0]||"",this.addrData.city_name=a.labelArr[1]||"",this.addrData.area_name=a.labelArr[2]||"",this.addrData.address=a.label,this.addressName=this.addrData.address},choiceMapAddr:function(e){var t=this;a.authorize({scope:"scope.userLocation",success:function(){a.chooseLocation({success:function(a){if(console.log("位置",a),a&&a.name){var e=t.resolveAddr(a);t.addrData.province_name=e.province||"",t.addrData.city_name=e.city||"",t.addrData.area_name=e.area||"",t.addrData.address=e.addr,t.addressName=t.addrData.address,t.addrData.longitude=a.longitude+"",t.addrData.latitude=a.latitude+"",t.addrData.addr_detail=a.name}},fail:function(a){console.log(a)}})},fail:function(e){a.showModal({title:"位置未授权，打开设置",success:function(e){e.confirm&&a.openSetting({})}})}})},resolveAddr:function(a){var e=a.address,t={addr:""},r=0,d=e.indexOf("省");-1==d?(r=e.indexOf("自治区"),-1!=r?t.province=e.substring(0,r+3):(t.province=e.substring(0,0),r=0)):t.province=e.substring(0,d+1),t.province&&(t.addr+=t.province+"-");var n=e.indexOf("市");-1==n?(r=e.indexOf("自治州"),t.city=-1!=r?e.substring(d+1,r+3):e.substring(r+1,n+1)):t.city=0==r?e.substring(d+1,n+1):e.substring(r+3,n+1),t.city&&(t.addr+=t.city+"-");var i=e.lastIndexOf("区");return-1==i?(i=e.indexOf("县"),t.area=0==r?e.substring(n+1,i+1):e.substring(r+3,i+1)):t.area=0==r?e.substring(n+1,i+1):e.substring(r+3,i+1),t.area&&(t.addr+=t.area),t},submit:function(){var e=this;return(0,n.default)(d.default.mark((function t(){var r;return d.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.addrDefault?e.addrData.is_default="是":e.addrData.is_default="否",r=e.addrData,r.consignee){t.next=5;break}return e.$api.msg("请填写收货人"),t.abrupt("return");case 5:if(/(^1[3|4|5|7|8|9][0-9]{9}$)/.test(r.mobile)){t.next=8;break}return e.$api.msg("请输入正确的手机号码"),t.abrupt("return");case 8:if(r.address){t.next=11;break}return e.$api.msg("请选择地址"),t.abrupt("return");case 11:if(r.addr_detail){t.next=14;break}return e.$api.msg("请填写详细地址"),t.abrupt("return");case 14:if(!e.addrDefault){t.next=17;break}return t.next=17,e.$db[i].where('create_uid == $env.uid && is_default == "是"').update({is_default:"否"});case 17:if("add"!=e.type){t.next=21;break}e.$db[i].add(r).then((function(t){if(200===t.code)return e.$api.msg("添加成功"),void e.$api.timerout((function(){a.navigateBack()}),100);e.$api.msg(t.msg)})),t.next=25;break;case 21:if(e.id){t.next=24;break}return e.$api.msg("当前ID异常，编辑失败"),t.abrupt("return");case 24:e.$db[i].update(e.id,r).then((function(t){if(200===t.code)return e.$api.msg("编辑成功"),void e.$api.timerout((function(){a.navigateBack()}),100);e.$api.msg(t.msg)}));case 25:case"end":return t.stop()}}),t)})))()}}};e.default=s}).call(this,t("543d")["default"])},"156b":function(a,e,t){"use strict";t.d(e,"b",(function(){return d})),t.d(e,"c",(function(){return n})),t.d(e,"a",(function(){return r}));var r={useAddress:function(){return Promise.all([t.e("common/vendor"),t.e("components/use-address/use-address")]).then(t.bind(null,"c824"))}},d=function(){var a=this.$createElement;this._self._c},n=[]},"2ddb":function(a,e,t){"use strict";t.r(e);var r=t("156b"),d=t("52c5");for(var n in d)["default"].indexOf(n)<0&&function(a){t.d(e,a,(function(){return d[a]}))}(n);t("64e3");var i=t("f0c5"),s=Object(i["a"])(d["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);e["default"]=s.exports},"2fac":function(a,e,t){"use strict";(function(a,e){var r=t("4ea4");t("cd95"),t("a9ff");r(t("66fd"));var d=r(t("2ddb"));a.__webpack_require_UNI_MP_PLUGIN__=t,e(d.default)}).call(this,t("bc2e")["default"],t("543d")["createPage"])},3388:function(a,e,t){},"52c5":function(a,e,t){"use strict";t.r(e);var r=t("0f68"),d=t.n(r);for(var n in r)["default"].indexOf(n)<0&&function(a){t.d(e,a,(function(){return r[a]}))}(n);e["default"]=d.a},"64e3":function(a,e,t){"use strict";var r=t("3388"),d=t.n(r);d.a}},[["2fac","common/runtime","common/vendor"]]]);